(function($,N){typeof exports=="object"&&typeof module!="undefined"?N(exports,require("crypto"),require("path"),require("posthtml"),require("posthtml-expressions"),require("posthtml-match-helper"),require("posthtml-render"),require("lodash"),require("fs-extra"),require("postcss"),require("postcss-load-config"),require("postcss-safe-parser"),require("postcss-selector-parser"),require("connect-history-api-fallback"),require("fast-glob"),require("shelljs"),require("circular"),require("execa"),require("html-minifier-terser"),require("@rollup/pluginutils"),require("node-localstorage")):typeof define=="function"&&define.amd?define(["exports","crypto","path","posthtml","posthtml-expressions","posthtml-match-helper","posthtml-render","lodash","fs-extra","postcss","postcss-load-config","postcss-safe-parser","postcss-selector-parser","connect-history-api-fallback","fast-glob","shelljs","circular","execa","html-minifier-terser","@rollup/pluginutils","node-localstorage"],N):($=typeof globalThis!="undefined"?globalThis:$||self,N($.posthtmlView={},$.crypto,$.path,$.posthtml,$.expressions,$.match,$.posthtmlRender,$.lodash,$.fse,$.postcss,$.postcssrc,$.postcssSafeParser,$.postcssSelectorParser,$.history,$.fg,$.shell,$.circular,$.execa,$.htmlMinifierTerser,$.pluginutils,$.nodeLocalstorage))})(this,function($,N,te,ee,se,re,ae,ht,ne,ce,ie,le,oe,ue,fe,pe,he,de,me,ge,ye){"use strict";function A(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var R=A(te),B=A(ee),_e=A(se),P=A(re),G=A(ne),ve=A(ce),we=A(ie),dt=A(le),mt=A(oe),be=A(ue),xe=A(fe),gt=A(pe),$e=A(he),je=A(de);function Pe(t,e=0){const s=1540483477,r=24;let a=t.length,c=e^a,o=0;for(;a>=4;){let u=Ie(t,o);u=M(u,s),u^=u>>>r,u=M(u,s),c=M(c,s),c^=u,o+=4,a-=4}switch(a){case 3:c^=yt(t,o),c^=t.charCodeAt(o+2)<<16,c=M(c,s);break;case 2:c^=yt(t,o),c=M(c,s);break;case 1:c^=t.charCodeAt(o),c=M(c,s);break}return c^=c>>>13,c=M(c,s),c^=c>>>15,c>>>0}function Ie(t,e){return t.charCodeAt(e++)+(t.charCodeAt(e++)<<8)+(t.charCodeAt(e++)<<16)+(t.charCodeAt(e)<<24)}function yt(t,e){return t.charCodeAt(e++)+(t.charCodeAt(e++)<<8)}function M(t,e){t|=0,e|=0;const s=t&65535,r=t>>>16;return s*e+((r*e&65535)<<16)|0}function _t(t){return Pe(t).toString(36)}const Ce=/[^-_a-z0-9\u00A0-\uFFFF]/gi,ke=/^\d/;function J(t,e){return t&&t.replace(Ce,e||"_").replace(ke,e||"_")}const Ee=/^(https?:)?\/\//,vt=t=>Ee.test(t),Se=/^\s*data:/i,wt=t=>Se.test(t),De=/({|%|:|})/g;function bt(t){return t.replace(De,"\\$1")}function*Y(t=[],e=!0,s){s=s||(d=>!0);let r="abcdefghijklmnopqrstuvwxyz";e&&(r=r+r.toUpperCase());const c=r+"0123456789",o=r.length,u=c.length;t=[...t||[],/ad/i];let h=0,g=0;for(;;){let d=o,v="";do v=v+c.charAt(g%d),g=~~(g/d),d=u;while(g>0);!t.some(f=>f.test(v))&&s(v)&&(yield v),h++,g=h}}function Re(t,e,s,r){return R.default.join(R.default.isAbsolute(r)?t:R.default.dirname(s||e),r)}function Ae(t,e,s){return e=Te(R.default.normalize(R.default.relative(t,e))),s?e[0]==="/"?e:`/${e}`:e}function Te(t){const e=/^\\\\\?\\/.test(t),s=/[^\u0000-\u0080]+/.test(t);return e||s?t:t.replace(/\\/g,"/")}const qe=require("cssjanus"),xt=new Map,$t=/\/\*(.*?)\*\//gs,Me=/--noflip-rtl-placeholder-\d+:\s*1;?/g,He=/{(.*?)}/gs;function Z(t,e){const s=xt.get(t);if(s)return s;let r=X(t);return r=qe.transform(r,{transformDirInUrl:!1,transformEdgeInUrl:!1,...e}),r=r.replace($t,""),xt.set(t,r),r}function jt(t){return t.replace(He,e=>{let s=-1;return e.replace($t,r=>r.includes("@noflip")?(s=s+1,`--noflip-rtl-placeholder-${s}:1;`):r)})}function X(t,e){return t.replace(Me,e===""?e:"/* @noflip */")}function Ne(t,e,s){return function(r){const a=t.content||[],c={};a.length&&r.match.call(a,P.default("template"),u=>(!u.attrs||!u.attrs.slot||(c[u.attrs.slot]=u),u));const o=r.match(P.default("slot"),u=>{const h=u.attrs&&u.attrs.name||"";if(!h)return Pt(u.content,a.filter(d=>!(d.tag==="template"&&d.attrs&&d.attrs.slot)));const g=c[h];return g?Pt(u.content,g.content,Ue(g)):u.content||[]});return t.tag=!1,t.content=o,r}}function Pt(t,e,s){switch(t=Array.isArray(t)?t:[t||""],e=Array.isArray(e)?e:[e||""],s){case"replace":t=e;break;case"prepend":t=[...e,...t];break;case"append":t=[...t,...e];break;default:t=e.filter(Boolean).length===0?t:e;break}return t}function Ue(t){let e=t.attrs&&t.attrs.type||"";return["replace","prepend","append"].includes(e)||(e="replace"),e}function It(t,e,s,r){return B.default((r||[]).concat(e)).process(ae.render(s),t).then(a=>a.tree)}function Oe(t,e,s){const r={};Object.entries(e||{}).forEach(([c,o])=>{r[c]=Fe(o)});const a={[s.$attrs]:ht.merge({},s.locals,t,r)};return _e.default({locals:a})}function Fe(t){try{return new Function(`return ${t}`)()}catch{return t}}let tt;async function Be({registerComponentsFile:t,root:e,mode:s,encoding:r,prefix:a,join:c,slash:o}){if(tt)return tt;if(!t)return{};const u={},h=c(e,t),g=await G.default.readFile(h,r);function d(v){v.match(P.default(a("components")),f=>(f.content&&f.content.forEach(p=>{if(typeof p=="string")return;let{src:_,...i}=p.attrs||{};p.tag&&_&&(_=c(h,_),u[p.tag]={tag:p.tag,src:_,resolveId:o(_),locals:i})}),f))}return await B.default([]).use(d).process(g,{}),s!=="development"&&(tt=u),u}const Le=/\B([A-Z])/g;function Ve(t){return(t||"").replace(Le,"-$1").toLowerCase()}function We(t){let e=t.replace(".html","-html").replace(/\.|_/g,"").split("/").map(s=>Ve(s)).filter(Boolean);return J(e.join("-"),"-")}const z=/\\?{\\?%(\\?:|\\?#)(.*?)\\?%\\?}/gs;function K(t){const e=!!(t&&z.test(t));return z.lastIndex=0,e}function Ct(t){return K(t)}const Ge=/\.(ttf|eot|woff|woff2)$/;function Je(t){return t=t.split("#")[0],t=t.split("?")[0],Ge.test(t)}const ze=/\/\*(.*?)\*\//gs;function Ke(t){return t=t&&t.replace(ze,e=>K(e)?"":e),K(t)}const Qe=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marquee","menu","menuitem","meta","meter","nav","nobr","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","plaintext","pre","progress","q","rp","rt","rtc","ruby","s","samp","script","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp"],Ye=["a","animate","animateMotion","animateTransform","circle","clipPath","color-profile","defs","desc","discard","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","foreignObject","g","hatch","hatchpath","image","line","linearGradient","marker","mask","mesh","meshgradient","meshpatch","meshrow","metadata","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","solidcolor","stop","style","svg","switch","symbol","text","textPath","title","tspan","unknown","use","view"],Ze=/^(-\w+-)?animation-name$/,Xe=/^(-\w+-)?animation$/,ts=/-?keyframes$/,kt=/(?<=^|[^\w\-\u0080-\uffff])url\(\s*('[^']+'|"[^"]+"|[^'")]+)\s*\)/,Et=/image-set\(([^)]+)\)/;function et(t,e,s,r,a,c,o){const u=dt.default(t,{from:r}),h={classNames:[],tags:{},assetsCache:new Set},g=Object.create(null);let d=!1,v="";if(!o){let f=function(n){n.forEach(l=>{if(l.type==="atrule"&&(l.name==="media"||l.name==="supports"))f(l.nodes);else switch(l.type){case"rule":if([a,c].includes(l.selector+"{}"))return;cs(l.nodes),l.selector=At(ns(l.selector,v,h));break;case"atrule":if(ts.test(l.name))if(l.params.startsWith(":global"))l.params=At(l.params);else{const b=`_${i}`;l.params.endsWith(b)||(d=!0,g[l.params]=l.params=l.params+b)}break}})};const p=n=>n.replace(a,"").replace(c,""),_=s.mode==="production",i=_t(`scoped-${e}:`+(_?p(t||""):""));v=J((s.styled.prefix||"")+i),f(u.nodes)}return u.walkDecls(f=>{d&&(Ze.test(f.prop)&&(f.value=f.value.split(",").map(i=>g[i.trim()]||i.trim()).join(",")),Xe.test(f.prop)&&(f.value=f.value.split(",").map(i=>{const n=i.trim().split(/\s+/),l=n.findIndex(y=>g[y]);return l!==-1?(n.splice(l,1,g[n[l]]),n.join(" ")):i}).join(",")));const p=kt.test(f.value),_=Et.test(f.value);if(p||_){const i=l=>(l=s.join(r,l),l=s.slash(l,!0),h.assetsCache.add(l),l),n=p?es:ss;f.value=n(f.value,i)}}),{scopedHash:v,scopedClasses:h,css:u.toString()}}function es(t,e){return St(t,kt,s=>{const[r,a]=s;return Dt(a,r,e)})}function ss(t,e){return St(t,Et,s=>{const[r,a]=s;return`image-set(${as(a,({url:o})=>Dt(o,r,e))})`})}function St(t,e,s){let r,a=t,c="";for(;r=e.exec(a);)c+=a.slice(0,r.index),c+=s(r),a=a.slice(r.index+r[0].length);return c+=a,c}function Dt(t,e,s){let r="";const a=t[0];return(a==='"'||a==="'")&&(r=a,t=t.slice(1,-1)),vt(t)||wt(t)||t.startsWith("#")?e:`url(${r}${s(t)}${r})`}const rs=/( |\\t|\\n|\\f|\\r)+/g;function as(t,e){const r=t.split(",").map(a=>{const[c,o]=a.replace(rs," ").trim().split(" ",2);return{url:c,descriptor:o}}).filter(({url:a})=>!!a).map(({url:a,descriptor:c})=>({url:e({url:a,descriptor:c}),descriptor:c}));return r.reduce((a,{url:c,descriptor:o},u)=>(o=o||"",a+=c+` ${o}${u===r.length-1?"":", "}`),"")}function ns(t,e,s){return mt.default(r=>{r.walk(a=>{if((a.type==="class"||a.type==="tag")&&!(Rt(a.parent)||Rt(a.parent&&a.parent.parent))){let o=a.value;a.type==="class"&&(Ct(o)&&(o=bt(o)),s.classNames.includes(o)||s.classNames.push(o)),a.type==="tag"&&(s.tags[o]=!0),a.setPropertyWithoutEscape("value",`${o}.${e}`)}})}).processSync(t)}function cs(t){t.forEach(e=>{e.type==="decl"&&["undefined","null"].includes(e.value)&&(e.remove(),e.cleanRaws())})}function Rt(t){return!!(t&&t.type==="pseudo"&&t.value===":global")}const is=/:global\((.*?)\)/gs;function At(t){return t.replace(is,"$1")}let H,L;const Tt=()=>{try{H=H||we.default.sync()}catch{H={file:"",options:{},plugins:[]}}L=L||ve.default(H.plugins)};function ls(t){function e(s,r){return async function(a){const c=[],o=ds(a,s);if(a.walk(u=>{if(typeof u=="string"||!u.tag)return u;const h=u.attrs||{},g=hs(h,u.tag,o,s);if(g){if(Qe.includes(g.tag))throw new Error(`The component <${g.tag}> is the HTML tag. page file: ${s.from}`);if(Ye.includes(g.tag))throw new Error(`The component <${g.tag}> is the SVG tag. page file: ${s.from}`);u.attrs&&delete u.attrs[s.prefix("query")],c.push(ps(g,s.encoding).then(us(u,g,s)).then(d=>{const v={...s,from:g.src};return e(v,!1)(d)}).then(Ne(u)))}return u}),r){const u=s.slash(s.from);c.push(qt(null,{tag:u.replace(/\/|\./g,"-"),src:s.from,resolveId:u,locals:{}},s)(a))}return c.length>0&&(await Promise.all(c),c.length=0),r?await os(a,s):a}}return e(t,!0)}async function os(t,e){const{styled:s,js:r,from:a,mode:c,rtl:o}=e,u=c==="development",h="",g="__posthtml_view_css__";let d="";const v=[];u&&(t.match(P.default("body"),m=>{const w={tag:"div",attrs:{id:g,"data-id":"development_css_container",style:"display: none !important;"}};return m.content=[w,...m.content||[]],m}),t.match(P.default("html"),m=>(m.attrs=m.attrs||{},m.attrs.dir=o?"rtl":"ltr",m)));const f=new Map,p=[],_=new Map,i=[],n=typeof s.extract=="function";t.match(P.default("style"),function(m){const w=Q(m.content);m.attrs=m.attrs||{};const x=m.attrs["data-scoped-hash"]||"",I=m.attrs["data-resolve-id"]||"";let T=m.attrs["data-to"]||s.to||"head";if(u&&T!=="*"&&(T=`#${g}`),(m.attrs["data-to"]==="file"||T==="file")&&n)w&&!_.has(I)&&(_.set(I,{}),!i.includes(I)&&i.push(I),_.set(I,{to:"file",css:w,scopedHash:x,resolveId:I}));else if(w&&!f.has(I)){if(f.set(I,{}),T==="*")return u||(delete m.attrs["data-to"],delete m.attrs["data-scoped-hash"],delete m.attrs["data-resolve-id"]),m;!p.includes(I)&&p.push(I),f.set(I,{to:T,css:w,scopedHash:x,resolveId:I})}return m.tag=!1,delete m.content,m});const l=new Map,y=r.type==="ts"?"ts":"js",b=m=>{r&&typeof r.extract=="function"&&r.extract(m)};t.match(P.default("script[data-resolve-id]"),m=>{m.attrs=m.attrs||{};const w=m.attrs["data-resolve-id"]||"";if(w&&!l.has(w)){l.set(w,null);const x=m.attrs.src||"",I=m.attrs["data-scoped-hash"]||"",T=(x?"":Q(m.content))||"";let S=x&&R.default.extname(x).replace(".","")||y;S=S==="ts"?"ts":"js",b({type:S,from:a,resolveId:w,scopedHash:I,source:T,mainjs:d||C(),src:x.replace(`.${S}`,"")})}return m.tag=!1,delete m.content,m});function C(){if(d)return d;let m;return t.match(P.default('script[type="module"]'),w=>(!m&&w.attrs&&w.attrs.src&&(w.attrs.src=w.attrs.src+"?__posthtml_view__=0",m=w.attrs.src),w)),!m&&Array.isArray(t)&&(m=e.slash(a,!0).replace(".html","."+y)+"?__posthtml_view__=1",t.push({tag:"script",attrs:{type:"module",src:m}})),d=m,m}const k=new Set;return Tt(),i.forEach(m=>{const w=_.get(m);if(!!w&&!!w.css){if(u){w.to=`#${g}`,k.add(w.to),t.match(P.default(w.to),x=>{k.delete(w.to);const I={tag:"style",attrs:{"data-to":"file","data-scoped-hash":w.scopedHash,"data-resolve-id":w.resolveId},content:w.css};return x.content?x.content=[I,...x.content]:x.content=[I],x});return}n&&v.push(L.process(w.css,{...H.options,from:a||void 0}).then(x=>{s.extract&&s.extract({type:"css",from:a,mainjs:d||C(),resolveId:w.resolveId,scopedHash:w.scopedHash,source:x.css})}))}}),p.forEach(m=>{const w=f.get(m);!w||!w.css||(k.add(w.to),t.match(P.default(w.to),x=>{switch(k.delete(w.to),x.tag){case"head":const I=x.content&&x.content.find(S=>!S||typeof S=="string"?!1:S.tag==="style"&&S.attrs&&S.attrs[g]===h);if(I)I.content=[...I.content,w.css].filter(Boolean);else{const S={tag:"style",attrs:{[g]:h},content:w.css};x.content?x.content=[...x.content,S]:x.content=[S]}break;case"style":x.content=[...x.content||[],w.css].filter(Boolean);break;default:const T={tag:"style",attrs:{"data-scoped-hash":w.scopedHash,"data-resolve-id":w.resolveId},content:w.css};x.content?x.content=[...x.content,T]:x.content=[T];break}return x}))}),t.walk(m=>(m.tag&&m.attrs&&(Object.entries(m.attrs).forEach(([w,x])=>{["null","undefined"].includes(x)&&delete m.attrs[w]}),m.attrs.class=(m.attrs.class||"").trim(),m.attrs.class||delete m.attrs.class),m)),t.match(P.default("style"),m=>{const w=Q(m.content);return w&&v.push(L.process(w,{...H.options,from:a||void 0}).then(x=>{m.content=[x.css]})),m}),k.forEach(m=>{throw Error("Invalid selector: "+m)}),await Promise.all(v).then(()=>t)}function us(t,e,s){return function(r){return typeof s.htmlProcessor=="function"&&(r=s.htmlProcessor(r)),It(s.parser,s.plugins,r,[qt(t,e,s),Oe(e.locals,t.attrs,s)])}}function qt(t,e,s){Tt();const{stylePreprocessor:r,styled:a,assets:c,noflip:o,cssjanus:u}=s,h=g=>Promise.resolve(r(g));return async function(g){const d=[];let v=!1,f="",p=null;if(g.match(P.default("style"),i=>{const n=i.attrs||{},l=fs(a,n),y=Q(i.content);let b=n.src;const C=n.dynamic!=null||Ke(y);return(b||y)&&d.push(Promise.resolve(null).then(()=>b?(b=s.join(e.src,b),G.default.readFile(b,s.encoding)):Promise.resolve(y)).then(k=>k?(k=o(k),h(k)):{code:""}).then(k=>{const m=k&&k.code;return{...k,code:u(m||""),to:C&&l.to==="file"?"head":l.to,type:l.type}})),v&&(i.tag=!1,delete i.content),v=!0,i}),d.length>0){const i=await Promise.all(d);d.length=0;const n=i[0].type;let l="",y="",b=a.to;const C=":__posthtml_view_to_file_start_mark__{}",k=":__posthtml_view_to_file_end_mark__{}";i.forEach(j=>{j.to==="file"&&j.code&&(j.code=`${C}${j.code}${k}`),j.type==="scoped"&&(l=l+(j.code||"")),j.type==="global"&&(y=y+(j.code||"")),j.to!=="file"&&j.to!==a.to&&(b=j.to)});const m=et(l,e.resolveId,s,e.src,C,k,!1),w=et(y,e.resolveId,s,e.src,C,k,!0);l=m.css,f=m.scopedHash,p=m.scopedClasses,y=w.css,w.scopedClasses.assetsCache.forEach(j=>{p&&p.assetsCache.add(j)}),w.scopedClasses.assetsCache.clear(),i.length=0;const x=j=>{let pt="";return j=j.replace(/:__posthtml_view_to_file_start_mark__{}(.*?):__posthtml_view_to_file_end_mark__{}/gs,function(Ls,Bs){return pt=pt+Bs,""}),{css:j,fileCss:pt}},I=x(l),T=x(y);l=I.css,y=T.css;let S="";n==="global"?S=T.fileCss+I.fileCss:S=I.fileCss+T.fileCss,g.match(P.default("style"),j=>(n==="global"?j.content=[y+l]:j.content=[l+y],l="",y="",j.attrs=j.attrs||{},j.attrs["data-to"]=b,j.attrs["data-scoped-hash"]=f,j.attrs["data-resolve-id"]=e.resolveId,delete j.attrs.scoped,delete j.attrs.global,delete j.attrs.src,delete j.attrs.to,delete j.attrs.dynamic,j)),S&&Array.isArray(g)&&g.push({tag:"style",attrs:{"data-to":"file","data-scoped-hash":f,"data-resolve-id":e.resolveId},content:S})}const _=s.prefix("js");if(g.match(P.default("script"),i=>{i.attrs=i.attrs||{};let n=i.attrs.src;return n&&/^(https?:)?\/\//.test(n)?i:i.attrs[_]==="null"||i.attrs[_]==="false"?(delete i.attrs[_],i):n&&i.attrs.type&&i.attrs.type==="module"?(i.attrs.src=s.join(e.src,n),i.attrs.src=s.slash(i.attrs.src,!0),i):(i.attrs.type&&i.attrs[_]==null||(n&&(n=s.join(e.src,n),i.attrs.src=s.slash(n,!0)),i.attrs["data-to"]=i.attrs.to,i.attrs["data-scoped-hash"]=f,i.attrs["data-resolve-id"]=e.resolveId,delete i.attrs.to),i)}),g.walk(i=>{if(typeof i=="string")return i;if(i.attrs=i.attrs||{},p&&f&&i.tag){const n=i.attrs.class||"";(p.tags[i.tag]||p.classNames.some(l=>n.includes(l)))&&!n.includes(f)&&(i.attrs.class=`${f} ${n}`.trim())}return i.attrs.style&&d.push(L.process(i.attrs.style,{...H.options,from:e.src||void 0}).then(n=>{const l=".__posthtml_view_inline_css_123456_abcdef__{",y=et(`${l}${n.css}}`,e.resolveId,s,e.src,"","",!0);y.scopedClasses.assetsCache.forEach(C=>{p&&p.assetsCache.add(C)}),y.scopedClasses.assetsCache.clear();const b=y.css.replace(l,"").replace("}","");i.attrs&&(i.attrs.style=u(b))})),c.attributes.forEach(n=>{if(i.attrs[n]){const l=i.attrs[n];if(!String(l).trim()||vt(l)||wt(l)||l.startsWith("#")||K(l))return;let y=s.join(e.src,l);y=s.slash(y,!0),p&&p.assetsCache.add(y),i.attrs[n]=y}}),i}),d.length>0&&(await Promise.all(d),d.length=0),s.mode!=="development"&&p&&p.assetsCache.size){const i={tag:"div",attrs:{__posthtml_view_assets_div__:!0,style:"display:none;"},content:[]};p.assetsCache.forEach(n=>{Je(n)?i.content.push({tag:"link",attrs:{rel:"preload",as:"font",href:n,"data-raw-url":n}}):i.content.push({tag:"img",attrs:{src:n,"data-raw-url":n}})}),i.content.length&&Array.isArray(g)&&g.push(i),p.assetsCache.clear()}return g}}function fs(t,e){t={...t},t.to=e.to||t.to||"head";let s=t.type;return e.scoped!=null?s="scoped":e.global!=null&&(s="global"),t.type=s||"scoped",t}function ps(t,e){return t.source!=null?Promise.resolve(t.source||""):G.default.readFile(t.src,e)}function hs(t,e,s,r){const a=r.prefix("query");return(t[a]||"")==="global"?r.components[e]:s[e]||r.components[e]}function ds(t,{from:e,prefix:s,join:r,slash:a}){const c={};return t.match(P.default(s("components")),o=>(o.content&&o.content.forEach(u=>{if(typeof u=="string")return;let{src:h,...g}=u.attrs||{};u.tag&&h&&(h=r(e,h),c[u.tag]={tag:u.tag,src:h,resolveId:a(h),locals:g})}),o.tag=!1,delete o.content,o)),t.match(P.default(s("component")),o=>{const u=o.attrs||{};let h=!1;if(u.src){const g="view-src-"+We(u.src),d=r(e,u.src);c[g]={tag:g,src:d,resolveId:a(d),locals:{}},o.tag=g,delete u.src}else h=!0;return h&&(o.tag=!1,delete o.content),o}),c}function Q(t){return[].concat(t||"").join("").trim()}function Mt(t){const e={...t||{}};return e.root=e.root||process.cwd(),e.mode=e.mode||"development",e.encoding=e.encoding||"utf8",e.viewPrefix=e.viewPrefix||"view:",e.from=e.from||"",e.plugins=e.plugins||[],e.parser=e.parser||{},e.locals=e.locals||{},e.$attrs=e.$attrs||"$attrs",e.stylePreprocessor=e.stylePreprocessor||(s=>({code:s})),e.js={type:"ts",...e.js},e.assets={...e.assets},e.assets.attributes=e.assets.attributes||["data-src","data-img"],e.styled={type:"scoped",to:"head",prefix:"view-",...e.styled},typeof e.getOptions=="function"&&e.getOptions(e),e.join=(s,r)=>Re(e.root,e.from,s,r),e.slash=(s,r)=>Ae(e.root,s,r),e.prefix=s=>`${e.viewPrefix}${s}`,e.rtl=e.rtl||!1,e.cssjanus=s=>e.rtl&&e.mode==="development"?Z(s,{transformEdgeInUrl:e.rtl.transformEdgeInUrl,transformDirInUrl:e.rtl.transformDirInUrl}):s,e.noflip=s=>e.rtl?jt(s):s,async function(r){e.components=await Be(e);const a=await ls(e)(r);return await It(e.parser,e.plugins,a)}}const Ht=/\.(css|scss|less|sass|styl|stylus|pcss|postcss)$/;function Nt(t){const e=Ht.test(t);return Ht.lastIndex=0,e}function ms(t,e){t.build=t.build||{},t.build.rollupOptions=t.build.rollupOptions||{},t.build.ssr=!1;const{input:s,pages:r}=ys(t.root||process.cwd(),e);return t.build.rollupOptions.input=s,t.server=t.server||{},t.server.open===!0&&(t.server.open=r[0]&&`/${r[0].route||""}`||"/"),t}function gs(t){const e=[];return Ut(t).forEach(r=>{const a=`./${r.path}`;r.pageName==="index"&&e.push({from:/^\/$/,to:a}),e.push({from:new RegExp(`^/${r.route}/*`),to:a}),e.push({from:new RegExp(`^/${r.route}$`),to:a})}),e}function ys(t,e){const s=Ut(e),r={};return s.forEach(a=>{r[a.pageName]=R.default.resolve(t,a.path)}),{input:r,pages:s}}function Ut({pagesDirectory:t,includes:e,ignore:s}){return e=e.filter(Boolean).map(r=>r[0]==="/"?r:"/"+r),xe.default.sync(`${t}/**/*.html`.replace("//","/"),{objectMode:!0,ignore:s.map(r=>(r.includes(".")?r:`**/${r}/**`).replace("//","/"))}).filter(r=>e.some(a=>r.path.includes(a))?!0:!r.path.includes("/_")).map(({name:r,path:a})=>{const c={filename:r,path:a,route:"",pageName:""};return c.route=a.replace(`${t}/`,""),c.pageName=c.route.replace(/(\/index)?\.html/,"").replace("/","-"),c})}const Ot="0123456789abcdef",Ft={"=":"\\:",php:"\\#","\\:":"=","\\#":"php"},Bt=/\\{\\%(\\:|\\#)(.*?)\\%\\}/gs,_s=/<\?(=|php)(.*?)\?>/gs,vs=/(\\%\\})=""/g;function Lt(t){return t.replace(Bt,function(e,s,r){return`<?${Ft[s]||s}${r}?>`})}function Vt(t){return t.replace(_s,function(e,s,r){return`\\{\\%${Ft[s]||s}${ws(r,Ot)}\\%\\}`})}function Wt(t){return t.replace(vs,"$1").replace(Bt,function(e,s,r){return`\\{\\%${s}${bs(r,Ot)}\\%\\}`})}function ws(t,e){const s=N.createCipheriv("aes128",e,e);let r=s.update(t,"utf8","hex");return r+=s.final("hex"),r}function bs(t,e){const s=N.createDecipheriv("aes128",e,e);let r=s.update(t,"hex","utf8");return r+=s.final("utf8"),r}async function xs(t,e=!0){let s=null;if(t){const r=gt.default.test("-f",t),a=t.replace(".ts",".js"),c=r||gt.default.test("-f",a);try{let o=null;const u=h=>{e&&require&&require.cache&&!!require.cache[h]&&delete require.cache[h]};r?(u(t),o=require(t)):c&&(u(a),o=require(a)),o&&(s=o.__esModule?o.default:o)}catch(o){console.error(o)}}return s||{}}const Gt=new Map;async function $s(t,e,s,r){const a=R.default.join(s,".php-dev",r);return Gt.get(r)!==t&&(Gt.set(r,t),await G.default.outputFile(R.default.resolve(e,a),t,"utf8")),{tplFileName:a,__views:""}}async function js(t,e){const{__views:s,...r}=e,a=r;a._TEMPLATE=t,a._REGISTER_GLOBAL_MODEL=!0,a._VIEWS_PATH=s;const c=JSON.stringify(a,$e.default()),{stdout:o}=await je.default("php",[R.default.join(__dirname,"/loader.php")],{input:c});return o}const Jt={caseSensitive:!0,collapseBooleanAttributes:!0,collapseInlineTagWhitespace:!0,collapseWhitespace:!0,html5:!0,minifyCSS:!0,minifyJS:!0,minifyURLs:!0,noNewlinesBeforeTagClose:!0,processScripts:["application/ld+json"],removeAttributeQuotes:!0,removeComments:!0,removeRedundantAttributes:!0,removeScriptTypeAttributes:!0,removeStyleLinkTypeAttributes:!0,removeTagWhitespace:!1,useShortDoctype:!0};let st;async function rt(t,e){return e.minifyHtml?(st=st||(e.minifyHtml===!0?Jt:{...Jt,...e.minifyHtml,removeTagWhitespace:!1}),t=await me.minify(t,st),Cs(t)):t}const Ps=/\s+(?=[:"'\[\]\{\}])/g,Is=/<script type="?application\/ld\+json"?>(.*?)<\/script>/gs;function Cs(t){try{t=t.replace(Is,s=>s.replace(Ps,""))}catch{}return t}function at(t){return t.split("?__posthtml_view__=")[0]}const ks=(t,e,s,r,a)=>{function c(h){const g=R.default.resolve(t.root,e.pagesDirectory);return R.default.relative(g,h)}const o=t.command==="serve",u='<div style="text-align:center;"><h1>posthtml-view</h1><p>No content</p></div>';return async(h,g)=>{const d=c(g.filename);e.php&&(h=Vt(h));const v=B.default([Mt({...e,from:g.filename,htmlProcessor(f){return Vt(f)},styled:{...e.styled,extract:f=>{const p=at(f.mainjs),_=`${s}/${f.resolveId.replace(".html",".css")}`,i=`import '${_}';`;a.set(_,f.source||"");const n=r.get(p)||"";n.includes(_)||r.set(p,n+i)}},js:{...e.js,extract:f=>{const p=at(f.mainjs);if(f.src){const _=r.get(p)||"",i=`import '${f.src}';`;_.includes(f.src)||r.set(p,_+i)}else{const _=`${s}/${f.resolveId.replace(".html","")}`,i=`import '${_}';`;a.set(_,f.source||"");const n=r.get(p)||"";n.includes(_)||r.set(p,n+i)}}}}),...e.plugins||[]]);if(typeof e.usePlugins=="function"&&e.usePlugins(v),h=(await v.process(h,{directives:[{name:"!DOCTYPE",start:"<",end:">"},{name:"?php",start:"<",end:">"},{name:"?=",start:"<",end:">"}],...e.parser,sync:!1})).html.trim(),o)if(e.php){if(h=Wt(h),e.devMinifyHtml&&(h=await rt(h,e)),h=Lt(h),typeof e.php.devRender=="function")h=await e.php.devRender({html:h,options:e});else{const f=R.default.join(t.root,e.mocksDirectory,d.replace(".html",".ts")),[p,{tplFileName:_,__views:i}]=await Promise.all([xs(f,!0),$s(h,t.root,e.cacheDirectory,d)]);h=await js(_,{__views:i,...p})}return h||u}else e.devMinifyHtml&&(h=await rt(h,e));return h}};let q,nt,ct,U;const E={classesKey:"_classes",idsKey:"_ids",_classes:{},_ids:{},classes:{},ids:{}},V={},W={};function zt(t,e){try{const s=U.getItem(t)||{};return Object.keys(s).forEach(r=>{const a=s[r];e[a]=null}),s}catch{return{}}}async function Es(){U&&(U.setItem(E.classesKey,E.classes),U.setItem(E.idsKey,E.ids))}function Ss(t){q=q||t,q.__cache_file__&&!U&&(U=new ye.JSONStorage(q.__cache_file__),E._classes=zt(E.classesKey,V),E._ids=zt(E.idsKey,W)),nt=nt||Y(q.generateNameFilters,q.upperCase,e=>V[e]!==null),ct=ct||Y(q.generateNameFilters,q.upperCase,e=>W[e]!==null)}function Kt(t){const e=dt.default(t);function s(r){r.forEach(a=>{if(a.type==="atrule"&&(a.name==="media"||a.name==="supports"))s(a.nodes);else switch(a.type){case"rule":a.selector=Ds(a.selector);break}})}return s(e.nodes),e.toString()}function Ds(t){return mt.default(e=>{e.walkClasses(s=>{if(O(s.value,!1,!1))return;let r=s.value,a=!1;const c=r.replace(z,o=>(a=!0,` ${o} `));if(a){r=c.split(/\s+/).map(o=>{if(!o)return"";if(O(o,!1))return o;const u=it(o);return F(u)||o}).filter(Boolean).join("").trim(),r=bt(r),s.setPropertyWithoutEscape("value",r);return}s.setPropertyWithoutEscape("value",F(it(r))||r)}),e.walkIds(s=>{O(s.value,!0)||(s.value=F(lt(s.value))||s.value)})}).processSync(t)}function it(t){const e=E._classes[t];if(e)return V[e]=null,E.classes[t]=e,delete E._classes[t],e;const s=E.classes[t];if(s)return V[s]=null,s;const r=nt.next().value;return V[r]=null,E.classes[t]=r,r}function lt(t){const e=E._ids[t];if(e)return W[e]=null,E.ids[t]=e,delete E._ids[t],e;const s=E.ids[t];if(s)return W[s]=null,s;const r=ct.next().value;return W[r]=null,E.ids[t]=r,r}function O(t,e,s){return s!==!1&&Ct(t)?!0:(t=(e?"#":".")+t,q.filters.some(r=>typeof r=="string"?r===t:r.test(t)))}function F(t){return t&&q.prefix+t}function Rs(t){if(O(t,!0))return;const e=lt(t);if(e)return F(e)}function Qt(t){if(t=t.slice(1),O(t,!0))return;const e=E.ids[t];if(e)return"#"+F(e)}const As=/\\?%\\?}(.*?)\\?{\\?%/gs,Ts=/\s+(\\?{\\?%)/g;function ot(t,e){return t&&(e||(t=t.replace(z,s=>` ${s} `)),t=t.split(/\s+/).map(s=>{if(!s)return"";if(O(s,e))return s;const r=e?lt(s):it(s);return F(r)||s}).filter(Boolean).join(" ").trim(),e||(t=t.replace(As,(s,r)=>r?s.replace(r,` ${r.trim()} `):s).replace(Ts,"$1")),t)}const Yt="[[rtl]]",Zt="[[ltr]]",ut={type:"syntax",syntax:`<?php if($rtl): ?>${Yt}<?php else: ?>${Zt}<?php endif; ?>`,devPreview:t=>!!(t&&(t.includes("rtl=1")||t.includes("lang=ar")))},Xt={enableCache:!0,generateNameFilters:[],upperCase:!0,filters:[/^(\.|#)js-/],attributes:[],prefix:"",__cache_file__:""};let D;function qs(t){return typeof t.rtl=="boolean"?t.rtl?ut:!1:{...ut,...t.rtl}}const Ms=/(.*)\[\[(rtl|ltr)\]\](.*)\[\[(rtl|ltr)\]\](.*)/si;function Hs(t,e){const s=ge.createFilter(["**/*.html"]);let r;const{type:a,syntax:c}=e||ut,o=d=>Z(d,{transformDirInUrl:e&&e.transformDirInUrl||!1,transformEdgeInUrl:e&&e.transformEdgeInUrl||!1}),u=()=>c&&(c.includes(Yt)||c.includes(Zt));let h=null;if(e&&a==="syntax"&&u()){const d=c.match(Ms);d&&d.length>=6&&(h=d.slice(1).map(v=>v.trim()).filter(Boolean))}const g=async d=>(await B.default([]).use(v=>(v.match(P.default("head"),f=>{const p=[];v.match(P.default("style[__posthtml_view_css__]"),i=>{const n=[].concat(i.content||"").join("").trim();return n&&!p.includes(n)&&p.push(n),i.tag=!1,delete i.content,i});const _=p.map(i=>({tag:"style",content:i}));if(f.content){const i=Us(f.content);i===null?f.content=[...f.content,..._]:f.content.splice(i+1,0,..._)}else f.content=_;return f}),D&&v.match(P.default("style"),f=>{if(f.attrs&&f.attrs["data-min-class-ignore"]!=null)return delete f.attrs["data-min-class-ignore"],f;const p=[].concat(f.content||"").join("").trim();return p&&(f.content=[Kt(p)]),f}),v)).use(v=>{const f=new Map,p=n=>(n&&f.size&&f.forEach((l,y)=>{n=Os(n,y,l)}),n);v.match(P.default("div[__posthtml_view_assets_div__]"),n=>(v.match.call(n,P.default("[data-raw-url]"),l=>(l.attrs&&l.attrs["data-raw-url"]&&f.set(l.attrs["data-raw-url"],l.attrs.href||l.attrs.src||""),l.tag=!1,l)),n.tag=!1,delete n.content,n));const _=t.assets.attributes;v.walk(n=>{if(n.attrs&&(_&&_.forEach(l=>{if(n.attrs[l]){const y=n.attrs[l];n.attrs[l]=f.get(y)||y}}),n.attrs.style&&(n.attrs.style=p(n.attrs.style))),D&&n.attrs){if(D.attributes&&D.attributes.length){const y=Object.keys(n.attrs);D.attributes.forEach(b=>{if(b==="id"||b==="class")return;const C=y.find(k=>k.includes(b));C&&(n.attrs[C]=ot(n.attrs[C]))})}if(n.attrs.class&&(n.attrs.class=ot(n.attrs.class)),n.attrs.id&&(n.attrs.id=ot(n.attrs.id,!0)),n.attrs.for){const y=Rs(n.attrs.for);y&&(n.attrs.for=y)}if(["mask","fill","filter"].forEach(y=>{if(n.attrs[y]){const b=Qt(n.attrs[y].replace(/url\((.*?)\)/g,"$1"));b&&(n.attrs[y]=`url(${b})`)}}),n.tag==="use"&&(n.attrs.href||n.attrs["xlink:href"])){const y=n.attrs.href?"href":"xlink:href",b=Qt(n.attrs[y]||"");b&&(n.attrs[y]=b)}}return n});const i="posthtml-view-syntax-style-x";return v.match(P.default("style"),n=>{let l=p([].concat(n.content||"").join("").trim()),y=l&&X(l,"");if(y&&h&&h.length){const b=o(l);if(b!==y)return n.content=h.map(C=>C==="rtl"?{tag:i,attrs:n.attrs,content:b}:C==="ltr"?{tag:i,attrs:n.attrs,content:y}:C),n.tag=!1,n.attrs=void 0,n}return y&&(n.content=[y]),n}),h&&h.length&&(v.match(P.default("link[href]"),n=>{const l=n.attrs&&n.attrs.href;if(n.attrs&&l&&l.endsWith(".css")&&h){const y=l.replace(".css",".rtl.css");n.attrs.href=h.map(b=>b==="rtl"?y:b==="ltr"?l:b).join("")}return n}),v.match(P.default("html"),n=>(h&&(n.attrs=n.attrs||{},n.attrs.dir=h.map(l=>l==="rtl"?"rtl":l==="ltr"?"ltr":l).join("")),n))),Promise.resolve().then(()=>(v.match(P.default(i),n=>(n.tag="style",n)),v))}).use(v=>Promise.resolve().then(()=>{let f;return typeof t.generateUsePlugins=="function"&&(f=t.generateUsePlugins(v)),f||v})).process(d,{})).html;return{name:"view:posthtml-view-bundle",enforce:"post",apply:"build",configResolved(d){r=d},async generateBundle(d,v){const f=t.minifyClassnames;f&&!D&&(D=f===!0?Xt:{...Xt,...f},D.prefix=D.prefix&&J(D.prefix),D.filters=[...D.filters,"#vite-legacy-polyfill","#vite-legacy-entry"],D.enableCache?D.__cache_file__=R.default.join(r.root,R.default.join(t.cacheDirectory,"css")):D.__cache_file__="",Ss(D));for(const p of Object.values(v)){if(p.type==="asset"&&p.fileName.endsWith(".css")){let _=ft(p.source);D&&(_=Kt(_)),p.source=X(_,""),e&&this.emitFile({type:"asset",fileName:p.fileName.replace(".css",".rtl.css"),name:p.name?p.name.replace(".css",".rtl.css"):void 0,source:o(_)})}if(p.type==="asset"&&s(p.fileName)){let _=ft(p.source);_=await g(_),t.php&&(_=Wt(_)),_=await rt(_,t),t.php&&(_=Lt(_)),p.source=_;const{fileName:i,name:n}=Ns(p.fileName,p.name,t);if(p.fileName=i,p.name=n,e&&a==="new-html"){const l=(await B.default([]).use(y=>(y.match(P.default("html"),b=>(b.attrs=b.attrs||{},b.attrs.dir="rtl",b)),y.match(P.default("link[href]"),b=>(b.attrs&&b.attrs.href&&b.attrs.href.endsWith(".css")&&(b.attrs.href=b.attrs.href.replace(".css",".rtl.css")),b)),y.match(P.default("style"),b=>{const C=[].concat(b.content||"").join("").trim();return C&&(b.content=[o(C)]),b}),y)).process(_,{})).html;l&&this.emitFile({type:"asset",fileName:i.replace(/\.(html?|php)/g,".rtl.$1"),name:n?n.replace(/\.(html?|php)/g,".rtl.$1"):void 0,source:l})}}if(p.type==="chunk"&&p.fileName.includes("-legacy")&&typeof t.removeCssInJs=="function"){const _=t.removeCssInJs(ft(p.code));p.code=_||p.code}}await Es()}}}function Ns(t,e,s){const{buildPagesDirectory:r,pagesDirectory:a,php:c}=s;if(r!==a){const o=t.indexOf(a);o>=0&&(t=r+t.slice(o+a.length))}return c&&c.rename&&(t=t.replace(/\.(html?)/g,".php"),e&&(e=e.replace(/\.(html?)/g,".php"))),{fileName:t,name:e}}function ft(t){return t instanceof Uint8Array?Buffer.from(t).toString("utf-8"):t}function Us(t){const e=t.length;let s=null;for(let r=e-1;r>=0;r--){const a=t[r];if(typeof a=="string")continue;const c=a.attrs||{};if(a.tag==="link"&&c.rel==="stylesheet"||a.tag==="link"&&c.rel==="modulepreload"||a.tag==="script"&&c.type==="module"&&c.src){s=r;break}}return s}function Os(t,e,s){for(;t.includes(e);)t=t.replace(e,s);return t}function Fs(t){const e=ht.merge({includes:[],ignore:[],pagesDirectory:"pages",mocksDirectory:"mocks",buildPagesDirectory:"pages",cacheDirectory:".posthtml-view-cache",usePlugins:null,rtl:!1,minifyHtml:!0,devMinifyHtml:!1,minifyClassnames:!1},t||{});e.pagesDirectory=e.pagesDirectory||"pages",e.buildPagesDirectory=e.buildPagesDirectory||e.pagesDirectory,e.cacheDirectory=e.cacheDirectory||".posthtml-view-cache",e.getOptions=h=>{e.styled=h.styled,e.assets=h.assets};const s=new Map,r=new Map,a="virtual:posthtml-view",c=qs(e),o=()=>{const h="view:posthtml-view-pages";let g;return{name:h,enforce:"pre",config(d,{mode:v}){ms(d,e)},configResolved(d){g=d,e.root=g.root,e.mode=g.command==="build"?"production":"development"},transformIndexHtml:{enforce:"pre",async transform(d,v){return g.command==="serve"?c&&typeof c.devPreview=="function"&&c.devPreview(v.originalUrl)?e.rtl=c:e.rtl=!1:e.rtl=c,await ks(g,e,a,s,r)(d,v)}},async resolveId(d,v){return d===a||/\?__posthtml_view__=(0|1)/g.test(d)||d.startsWith(a)?d:null},async load(d){if(d===a)return"";if(/\?__posthtml_view__=(0|1)/g.test(d)){const v=at(d),f=d.includes("__posthtml_view__=1");let p="";return f||(p=p+`import '${v.replace(/\.(t|j)s/g,"")}';`),p=p+(s.get(v)||""),p}return d.startsWith(a)?r.get(d)||"":null},async transform(d,v){return g.command==="build"&&c&&Nt(v)?jt(d):null}}};return[(()=>({name:"view:posthtml-view-dev",enforce:"pre",apply:"serve",configureServer(h){h.middlewares.use(be.default({verbose:Boolean({}.DEBUG)&&{}.DEBUG!=="false",disableDotRule:void 0,htmlAcceptHeaders:["text/html","application/xhtml+xml"],rewrites:gs(e)}))},async transform(h,g){return c&&e.rtl&&Nt(g)?Z(h,{transformDirInUrl:c.transformDirInUrl||!1,transformEdgeInUrl:c.transformEdgeInUrl||!1}):null},async handleHotUpdate({file:h,server:g}){return(h.includes("/"+e.mocksDirectory)||h.includes(".html"))&&g.ws.send({type:"full-reload",path:"*"}),[]}}))(),o(),Hs(e,c)]}$.compilerViewPlugin=Mt,$.generateName=Y,$.slugify=_t,$.toValidCSSIdentifier=J,$.vitePluginPosthtmlView=Fs,Object.defineProperty($,"__esModule",{value:!0}),$[Symbol.toStringTag]="Module"});
